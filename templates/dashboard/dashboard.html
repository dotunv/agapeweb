{% extends 'dashboard/base_dashboard.html' %}
{% load static %}

{% block page_title %}Dashboard Overview{% endblock %}

{% block title %}Dashboard - AgapeThrift{% endblock %}

{% block extra_css %}
{% include 'dashboard/dashboard_styles.html' %}
{% endblock %}

{% block content %}
<div class="content-grid">
    <div class="main-cards">
        <!-- Balance Card -->
        <div class="balance-card">
            <div class="balance-label">Current Balance</div>
            <div class="balance-amount">${{ user_balance|floatformat:2 }}</div>
            <div class="balance-meta">Username: {{ user.username }}</div>
        </div>

        <!-- Current Plan -->
        {% if current_plan %}
        <div class="current-plan">
            <div class="plan-header">
                <div class="plan-title">Current Plan</div>
                <div class="plan-badge">{{ current_plan.name }}</div>
            </div>
            <div class="progress-text">{{ current_plan.current_cycle }}/{{ current_plan.total_cycles }}</div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ current_plan.progress_percentage }}%"></div>
            </div>
            <div class="progress-note">{{ current_plan.withdrawal_note }}</div>
            <div class="plan-status">Status: {{ current_plan.status }}</div>
        </div>
        {% else %}
        <div class="current-plan">
            <div class="plan-header">
                <div class="plan-title">No Active Plan</div>
            </div>
            <div class="plan-status" style="color: #e74c3c;">Please select a plan to get started</div>
        </div>
        {% endif %}

        <!-- Recent Subscriptions -->
        <div class="recent-subscriptions">
            <div class="section-header">
                <h2 class="section-title">Recent Subscription</h2>
                <a href="{% url 'frontend:subscriptions' %}" class="view-all">View all</a>
            </div>
            <div class="subscription-list">
                {% if recent_subscriptions %}
                    {% for subscription in recent_subscriptions %}
                    <div class="subscription-item">
                        <div class="subscription-info">
                            <div class="subscriber-name">{{ subscription.user.get_full_name|default:subscription.user.username }}</div>
                            <div class="subscription-date">{{ subscription.created_at|date:"j M, Y" }}</div>
                        </div>
                        <div class="subscription-amount">+${{ subscription.amount|floatformat:2 }}</div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="subscription-item">
                        <div class="subscription-info">No recent subscriptions</div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Plans Section -->
    <div class="plans-section">
        <h2 class="plans-title">Plans</h2>
        <div class="plans-list">
            {% if available_plans %}
                {% for plan in available_plans %}
                <div class="plan-item">
                    <div class="plan-info">
                        <div class="plan-name">{{ plan.name }}</div>
                        <div class="plan-price">${{ plan.contribution_amount|floatformat:2 }}/person</div>
                    </div>
                    {% if user_plan %}
                        <button class="subscribe-btn disabled" disabled>Subscribe</button>
                    {% else %}
                        <a href="{% url 'frontend:subscribe_plan' plan.id %}" class="subscribe-btn">Subscribe</a>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="plan-item">
                    <div class="plan-info">No plans available</div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}